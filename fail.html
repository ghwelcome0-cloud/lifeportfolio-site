<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê²°ì œ ì‹¤íŒ¨ - ì¸ìƒí¬íŠ¸í´ë¦¬ì˜¤</title>
  <style>
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
        "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      background: #f9fafb;
      color: #111827;
      -webkit-font-smoothing: antialiased;
    }
    .wrap {
      max-width: 640px;
      margin: 0 auto;
      padding: 64px 20px;
      text-align: center;
      position: relative;
    }
    .top-links {
      position: absolute; top: 16px; right: 20px; font-size: 13px;
    }
    .top-links a { color:#ef4444; text-decoration:none; font-weight:600; margin-left:12px; }
    h1 {
      font-size: 26px;
      font-weight: 800;
      margin-bottom: 12px;
      color: #ef4444;
    }
    p {
      margin: 8px 0;
      font-size: 16px;
    }
    .btn {
      display: inline-block;
      margin-top: 24px;
      padding: 14px 24px;
      border-radius: 10px;
      background: #ef4444;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 15px;
      box-shadow: 0 6px 14px rgba(239, 68, 68, 0.25);
      transition: transform 0.2s ease;
    }
    .btn:hover { transform: translateY(-2px); }
    .note {
      color: #6b7280;
      margin-top: 20px;
      font-size: 14px;
      line-height: 1.6;
    }
    .result-box {
      margin-top: 20px;
      padding: 16px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      text-align: left;
      font-size: 14px;
      line-height: 1.6;
    }
    .result-box p { margin: 4px 0; }
  </style>
  <script>
    // âœ… Cognito í† í° íŒŒì‹±
    function parseHashParams() {
      const hash = window.location.hash.substr(1);
      const result = {};
      hash.split("&").forEach(part => {
        const [key, value] = part.split("=");
        if (key && value) result[key] = decodeURIComponent(value);
      });
      return result;
    }

    // âœ… JWT í† í° ë§Œë£Œ í™•ì¸
    function isTokenExpired(token) {
      try {
        const payload = JSON.parse(atob(token.split(".")[1]));
        return Date.now() >= payload.exp * 1000;
      } catch {
        return true;
      }
    }

    window.addEventListener("DOMContentLoaded", function(){
      // ğŸ”¹ Cognito í† í° í™•ì¸
      let tokens = parseHashParams();
      if (tokens.id_token || tokens.access_token) {
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("id_token", tokens.id_token || "");
        localStorage.setItem("access_token", tokens.access_token || "");
        window.location.hash = "";
      }

      const idToken = localStorage.getItem("id_token");
      const loggedIn = localStorage.getItem("loggedIn") === "true";

      if (!loggedIn || !idToken || isTokenExpired(idToken)) {
        alert("ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        localStorage.clear();
        sessionStorage.clear();
        window.location.replace("login.html");
        return;
      }

      // ğŸ”¹ ì‹¤íŒ¨ ì‹œ ì„¸ì…˜ ì •ë¦¬
      sessionStorage.removeItem("paid");
      sessionStorage.removeItem("last_order_id");

      // ğŸ”¹ Payple ë¦¬ë‹¤ì´ë ‰íŠ¸ íŒŒë¼ë¯¸í„° íŒŒì‹±
      const params = new URLSearchParams(window.location.search);
      const payResult = {
        result: params.get("PCD_PAY_RST"),
        msg: params.get("PCD_PAY_MSG"),
        oid: params.get("PCD_PAY_OID"),
        amount: params.get("PCD_PAY_TOTAL"),
        payType: params.get("PCD_PAY_TYPE"),
        payTime: params.get("PCD_PAY_TIME")
      };

      // ğŸ”¹ í™”ë©´ì— í‘œì‹œ
      const box = document.getElementById("resultBox");
      box.innerHTML = `
        <p><b>ê²°ì œ ê²°ê³¼:</b> ${payResult.result || "ì‹¤íŒ¨"}</p>
        <p><b>ì‹¤íŒ¨ ì‚¬ìœ :</b> ${payResult.msg || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}</p>
        <p><b>ì£¼ë¬¸ë²ˆí˜¸:</b> ${payResult.oid || "-"}</p>
        <p><b>ì‹œë„ ê¸ˆì•¡:</b> ${payResult.amount ? payResult.amount + "ì›" : "-"}</p>
        <p><b>ê²°ì œìˆ˜ë‹¨:</b> ${payResult.payType || "-"}</p>
        <p><b>ì²˜ë¦¬ì‹œê°:</b> ${payResult.payTime || "-"}</p>
      `;
    });
  </script>
</head>
<body>
  <div class="wrap">
    <div class="top-links">
      <a href="product.html">ìƒí’ˆ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <h1>âŒ ê²°ì œê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h1>
    <p>ê²°ì œê°€ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br/>ì•„ë˜ ì‹¤íŒ¨ ì‚¬ìœ ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>

    <div class="result-box" id="resultBox">
      ê²°ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>

    <a class="btn" href="product.html">
      ë‹¤ì‹œ ê²°ì œ ì‹œë„í•˜ê¸° â†’
    </a>

    <p class="note">
      ê³„ì† ë¬¸ì œê°€ ë°œìƒí•  ê²½ìš° ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.<br/>
      ê³ ê°ì„¼í„°: 070-8064-4176 Â· ì´ë©”ì¼ <a href="mailto:faise@lifeportfolio.co.kr">faise@lifeportfolio.co.kr</a>
    </p>
  </div>
</body>
</html>
