<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê²°ì œ ì™„ë£Œ - ì¸ìƒí¬íŠ¸í´ë¦¬ì˜¤</title>
  <style>
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
        "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      background: #f9fafb;
      color: #111827;
      -webkit-font-smoothing: antialiased;
    }
    .wrap {
      max-width: 640px;
      margin: 0 auto;
      padding: 64px 20px;
      text-align: center;
      position: relative;
    }
    .top-links {
      position: absolute; top: 16px; right: 20px; font-size: 13px;
    }
    .top-links a { color:#4f46e5; text-decoration:none; font-weight:600; margin-left:12px; }
    h1 {
      font-size: 26px;
      font-weight: 800;
      margin-bottom: 12px;
    }
    p {
      margin: 8px 0;
      font-size: 16px;
    }
    .btn {
      display: inline-block;
      margin-top: 24px;
      padding: 14px 24px;
      border-radius: 10px;
      background: #4f46e5;
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      font-size: 15px;
      box-shadow: 0 6px 14px rgba(79, 70, 229, 0.25);
      transition: transform 0.2s ease;
    }
    .btn:hover { transform: translateY(-2px); }
    .note {
      color: #6b7280;
      margin-top: 20px;
      font-size: 14px;
      line-height: 1.6;
    }
    .badge {
      margin-top: 28px;
      font-size: 13px;
      font-weight: 600;
      color: #4f46e5;
    }
    .result-box {
      margin-top: 20px;
      padding: 16px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      text-align: left;
      font-size: 14px;
      line-height: 1.6;
    }
    .result-box p { margin: 4px 0; }
  </style>
  <script>
    // âœ… Cognito í† í° íŒŒì‹±
    function parseHashParams() {
      const hash = window.location.hash.substr(1);
      const result = {};
      hash.split("&").forEach(part => {
        const [key, value] = part.split("=");
        if (key && value) result[key] = decodeURIComponent(value);
      });
      return result;
    }

    // âœ… JWT í† í° ë§Œë£Œ í™•ì¸
    function isTokenExpired(token) {
      try {
        const payload = JSON.parse(atob(token.split(".")[1]));
        return Date.now() >= payload.exp * 1000;
      } catch {
        return true;
      }
    }

    window.addEventListener("DOMContentLoaded", function(){
      // ğŸ”¹ Cognito í† í° í™•ì¸
      let tokens = parseHashParams();
      if (tokens.id_token || tokens.access_token) {
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("id_token", tokens.id_token || "");
        localStorage.setItem("access_token", tokens.access_token || "");
        window.location.hash = ""; // URL ì •ë¦¬
      }

      const idToken = localStorage.getItem("id_token");
      const loggedIn = localStorage.getItem("loggedIn") === "true";

      if (!loggedIn || !idToken || isTokenExpired(idToken)) {
        alert("ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        localStorage.clear();
        sessionStorage.clear();
        window.location.replace("login.html");
        return;
      }

      // ğŸ”¹ Payple ë¦¬ë‹¤ì´ë ‰íŠ¸ íŒŒë¼ë¯¸í„° í™•ì¸
      const params = new URLSearchParams(window.location.search);
      const payResult = {
        result: params.get("PCD_PAY_RST"),
        msg: params.get("PCD_PAY_MSG"),
        oid: params.get("PCD_PAY_OID"),
        amount: params.get("PCD_PAY_TOTAL"),
        payType: params.get("PCD_PAY_TYPE"),
        payTime: params.get("PCD_PAY_TIME")
      };

      if(payResult.result !== "success"){
        alert("ê²°ì œ ì‹¤íŒ¨ ë˜ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        window.location.replace("fail.html");
        return;
      }

      // ğŸ”¹ ê²°ì œ ê²°ê³¼ í‘œì‹œ
      const box = document.getElementById("resultBox");
      box.innerHTML = `
        <p><b>ê²°ì œ ê²°ê³¼:</b> ${payResult.result}</p>
        <p><b>ë©”ì‹œì§€:</b> ${payResult.msg || "-"}</p>
        <p><b>ì£¼ë¬¸ë²ˆí˜¸:</b> ${payResult.oid || "-"}</p>
        <p><b>ê²°ì œê¸ˆì•¡:</b> ${payResult.amount ? payResult.amount + "ì›" : "-"}</p>
        <p><b>ê²°ì œìˆ˜ë‹¨:</b> ${payResult.payType || "-"}</p>
        <p><b>ìŠ¹ì¸ì‹œê°:</b> ${payResult.payTime || "-"}</p>
      `;

      // ğŸ”¹ ì„¸ì…˜ì— ê²°ì œ ì™„ë£Œ ì €ì¥
      sessionStorage.setItem("paid", "true");
      sessionStorage.setItem("last_order_id", payResult.oid || "");
    });

    function logout(e){
      e.preventDefault();
      localStorage.clear();
      sessionStorage.clear();
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      window.location.href = "index.html";
    }
  </script>
</head>
<body>
  <div class="wrap">
    <div class="top-links">
      <a href="index.html">í™ˆ</a>
      <a href="#" onclick="logout(event)">ë¡œê·¸ì•„ì›ƒ</a>
    </div>

    <h1>âœ… ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h1>
    <p>ì¸ìƒí¬íŠ¸í´ë¦¬ì˜¤ ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div class="result-box" id="resultBox">
      ê²°ì œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>

    <a class="btn" href="https://forms.gle/xWTZFFZXaUacMyWm9" target="_blank" rel="noopener">
      ê²€ì‚¬ ì°¸ì—¬í•˜ê¸° â†’
    </a>

    <p class="note">
      ê²°ì œ ë° ì„œë¹„ìŠ¤ ì´ìš© ê´€ë ¨ ë¬¸ì˜: ê³ ê°ì„¼í„°(070-8064-4176) Â· ì´ë©”ì¼
      <a href="mailto:faise@lifeportfolio.co.kr">faise@lifeportfolio.co.kr</a>
    </p>

    <div class="badge">ì¸ìƒí¬íŠ¸í´ë¦¬ì˜¤ ì„œë¹„ìŠ¤ - íŒŒì´ìŠ¤</div>
  </div>
</body>
</html>
