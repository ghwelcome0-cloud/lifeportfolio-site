<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>ë¡œê·¸ì¸ | ì¸ìƒí¬íŠ¸í´ë¦¬ì˜¤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto,
                   "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      display: flex; justify-content: center; align-items: center;
      height: 100vh; margin: 0; background: #f3f4f6;
    }
    .box {
      background: #fff;
      padding: 32px 24px;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,.08);
      width: 100%; max-width: 340px;
      text-align: center;
    }
    h1 {
      font-size: 18px;
      margin-bottom: 10px;
      color: #4f46e5;
      font-weight: 700;
    }
    h2 {
      margin: 0 0 20px;
      font-size: 22px;
      font-weight: 700;
      color: #111827;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 16px;
      background: #4285F4;
      color: #fff;
      font-weight: 600;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform .2s ease, background .2s ease;
    }
    button:hover { transform: translateY(-2px); background:#3367d6; }
    .links {
      margin-top: 14px;
      font-size: 13px;
    }
    .links a {
      color:#4f46e5; text-decoration:none; font-weight:600;
    }
  </style>
  <script>
    // âœ… Cognito + Google ë¡œê·¸ì¸ (PKCE ë°©ì‹)
    const clientId = "vmdae3i5bq69kf1uh7k1gnh7"; // Cognito App Client ID
    const domain = "https://lifeportfolio.auth.ap-northeast-2.amazoncognito.com";
    const redirectUri = "https://lifeportfolio.co.kr/product.html"; // ë°˜ë“œì‹œ ë“±ë¡ëœ Callback URL
    const responseType = "code";
    const identityProvider = "Google"; // Google ê³ ì •
    const scope = "email openid phone profile";

    // ğŸ”‘ ëœë¤ ë¬¸ìì—´ ìƒì„±
    function generateRandomString(length) {
      const charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";
      let result = "";
      const cryptoObj = window.crypto || window.msCrypto;
      const randomValues = new Uint8Array(length);
      cryptoObj.getRandomValues(randomValues);
      for (let i = 0; i < randomValues.length; i++) {
        result += charset[randomValues[i] % charset.length];
      }
      return result;
    }

    // ğŸ“Œ Base64URL ì¸ì½”ë”©
    function base64urlencode(str) {
      return btoa(String.fromCharCode.apply(null, new Uint8Array(str)))
        .replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
    }

    // ğŸ“Œ SHA256 í•´ì‹±
    async function sha256(plain) {
      const encoder = new TextEncoder();
      const data = encoder.encode(plain);
      return await crypto.subtle.digest("SHA-256", data);
    }

    // âœ… PKCE ë¡œê·¸ì¸ ì‹œì‘
    async function redirectToGoogleLogin() {
      const codeVerifier = generateRandomString(64);
      localStorage.setItem("pkce_code_verifier", codeVerifier);

      const hashed = await sha256(codeVerifier);
      const codeChallenge = base64urlencode(hashed);

      const loginUrl = `${domain}/oauth2/authorize`
        + `?client_id=${clientId}`
        + `&response_type=${responseType}`
        + `&scope=${encodeURIComponent(scope)}`
        + `&redirect_uri=${encodeURIComponent(redirectUri)}`
        + `&identity_provider=${identityProvider}`
        + `&code_challenge=${codeChallenge}`
        + `&code_challenge_method=S256`;

      window.location.href = loginUrl;
    }
  </script>
</head>
<body>
  <div class="box">
    <h1>ì¸ìƒí¬íŠ¸í´ë¦¬ì˜¤</h1>
    <h2>ë¡œê·¸ì¸</h2>
    <button onclick="redirectToGoogleLogin()">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</button>
    <div class="links">
      <a href="signup.html">íšŒì›ê°€ì…</a> Â· <a href="index.html">â† í™ˆìœ¼ë¡œ</a>
    </div>
  </div>
</body>
</html>
